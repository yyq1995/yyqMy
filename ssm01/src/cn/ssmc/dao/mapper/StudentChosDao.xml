<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.ssmc.dao.StudentChosDao">
	<resultMap id="BaseResultMap" type="cn.ssmc.entity.StudentChos">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Mon Aug 21 
			10:16:56 CST 2017. -->
		<id column="id" jdbcType="INTEGER" property="id" />
		<result column="chos_id" jdbcType="INTEGER" property="chosId" />
		<result column="student_id" jdbcType="INTEGER" property="studentId" />
		<result column="student_no" jdbcType="INTEGER" property="studentNo" />
		<result column="student_sex" jdbcType="INTEGER" property="studentSex" />
		<result column="student_name" jdbcType="VARCHAR" property="studentName" />
		<result column="student_college_name" jdbcType="VARCHAR"
			property="studentCollegeName" />
		<result column="student_majoy_name" jdbcType="VARCHAR"
			property="studentMajoyName" />
		<result column="score" jdbcType="INTEGER" property="score" />
	</resultMap>
	<sql id="Base_Column_List">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Mon Aug 21 
			10:16:56 CST 2017. -->
		id, chos_id 'chooseCourse.id', student_id 'student.id', student_no
		'student.id', student_sex 'student.sex', student_name 'student.name',
		student_college_name 'student.college.name',
		student_majoy_name
		'student.major,name', score
	</sql>
	<select id="selectByPrimaryKey" parameterType="java.lang.Integer"
		resultMap="BaseResultMap">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Mon Aug 21 
			10:16:56 CST 2017. -->
		select
		<include refid="Base_Column_List" />
		from student_chos
		where id = #{id,jdbcType=INTEGER}
	</select>
	<delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Mon Aug 21 
			10:16:56 CST 2017. -->
		delete from student_chos
		where id = #{id,jdbcType=INTEGER}
	</delete>
	<insert id="insert" parameterType="cn.ssmc.entity.StudentChos">
		<selectKey keyProperty="id" order="AFTER" resultType="java.lang.Integer">
			SELECT
			LAST_INSERT_ID()
		</selectKey>
		insert into student_chos (chos_id, student_id, student_no,
		student_sex, student_name, student_college_name,
		student_majoy_name,
		score)
		values (#{chooseCourse.id,jdbcType=INTEGER},
		#{student.id,jdbcType=INTEGER},
		#{student.no,jdbcType=INTEGER},
		#{student.sex,jdbcType=INTEGER}, #{student.name,jdbcType=VARCHAR},
		#{student.college.name,jdbcType=VARCHAR},
		#{student.major.name,jdbcType=VARCHAR}, #{score,jdbcType=INTEGER})
	</insert>
	<insert id="insertSelective" parameterType="cn.ssmc.entity.StudentChos">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Mon Aug 21 
			10:16:56 CST 2017. -->
		<selectKey keyProperty="id" order="AFTER" resultType="java.lang.Integer">
			SELECT
			LAST_INSERT_ID()
		</selectKey>
		insert into student_chos
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="chosId != null">
				chos_id,
			</if>
			<if test="studentId != null">
				student_id,
			</if>
			<if test="studentNo != null">
				student_no,
			</if>
			<if test="studentSex != null">
				student_sex,
			</if>
			<if test="studentName != null">
				student_name,
			</if>
			<if test="studentCollegeName != null">
				student_college_name,
			</if>
			<if test="studentMajoyName != null">
				student_majoy_name,
			</if>
			<if test="score != null">
				score,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="chosId != null">
				#{chosId,jdbcType=INTEGER},
			</if>
			<if test="studentId != null">
				#{studentId,jdbcType=INTEGER},
			</if>
			<if test="studentNo != null">
				#{studentNo,jdbcType=INTEGER},
			</if>
			<if test="studentSex != null">
				#{studentSex,jdbcType=INTEGER},
			</if>
			<if test="studentName != null">
				#{studentName,jdbcType=VARCHAR},
			</if>
			<if test="studentCollegeName != null">
				#{studentCollegeName,jdbcType=VARCHAR},
			</if>
			<if test="studentMajoyName != null">
				#{studentMajoyName,jdbcType=VARCHAR},
			</if>
			<if test="score != null">
				#{score,jdbcType=INTEGER},
			</if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective" parameterType="cn.ssmc.entity.StudentChos">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Mon Aug 21 
			10:16:56 CST 2017. -->
		update student_chos
		set score=#{score}
		where id = #{id,jdbcType=INTEGER}
	</update>
	<update id="updateByPrimaryKey" parameterType="cn.ssmc.entity.StudentChos">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Mon Aug 21 
			10:16:56 CST 2017. -->
		update student_chos
		set chos_id = #{chosId,jdbcType=INTEGER},
		student_id = #{studentId,jdbcType=INTEGER},
		student_no =
		#{studentNo,jdbcType=INTEGER},
		student_sex =
		#{studentSex,jdbcType=INTEGER},
		student_name =
		#{studentName,jdbcType=VARCHAR},
		student_college_name =
		#{studentCollegeName,jdbcType=VARCHAR},
		student_majoy_name =
		#{studentMajoyName,jdbcType=VARCHAR},
		score = #{score,jdbcType=INTEGER}
		where id = #{id,jdbcType=INTEGER}
	</update>

	<select id="selectWithChooseStudView" resultType="cn.ssmc.entity.StudentChos">
		SELECT sc.id
		'id', c.id 'chooseCourse.id', c.no
		'chooseCourse.no',
		c.course_name
		'chooseCourse.course.name',
		c.course_credit
		'chooseCourse.course.credit', c.college_name
		'chooseCourse.college.name',
		teacher_name
		'chooseCourse.teacher.name',
		term_name 'chooseCourse.terms.name',
		classroom_id
		'chooseCourse.classTime.id',
		c.max 'chooseCourse.max',c.selected
		'chooseCourse.selected',
		t.flag 'chooseCourse.terms.flag',
		sc.score
		score
		FROM
		student_chos sc LEFT JOIN t_chos c
		ON
		sc.chos_id=c.id LEFT JOIN
		t_terms
		t ON t.id = c.term_id
		WHERE sc.student_id=#{studId}
		<if test="termFlag == 2">
			AND t.flag=2
		</if>
		<if test="termFlag != 2">
			AND t.flag!=2
		</if>
	</select>
	<select id="selectWithChooseView" parameterType="cn.ssmc.entity.StudentChos"
		resultType="cn.ssmc.entity.StudentChos">
		SELECT sc.id 'id',sc.student_name 'student.name',
		sc.student_id
		'student.id',sc.student_no
		'student.no',sc.student_college_name
		'student.college.name',sc.student_majoy_name
		'student.major.name',sc.student_sex 'student.sex',score
		,c.id
		'chooseCourse.id'
		FROM
		student_chos sc LEFT JOIN t_chos c ON
		sc.chos_id=c.id LEFT JOIN t_terms t ON t.id = c.term_id
		LEFT JOIN t_student s ON sc.student_id=s.id 
		WHERE
		c.id=#{chooseCourse.id}
		<if
			test="chooseCourse != null and chooseCourse.terms != null and chooseCourse.terms.flag == 2">
			AND t.flag = 2
		</if>
		<if
			test="chooseCourse != null and chooseCourse.terms != null and chooseCourse.terms.flag == 1">
			AND t.flag = 1
		</if>
		<if test="student != null and student.name != null">
			AND sc.student_name LIKE
			CONCAT('%',CONCAT(#{student.name},'%'))
		</if>
		<if
			test="student != null and student.college != null and student.college.name != null  ">
			AND sc.student_college_name like concat('%',concat(#{student.college.name},'%'))
		</if>
		<if
			test="student != null and student.college != null and student.college.id != 0  ">
			AND s.college_id=  #{student.college.id}
		</if>
	</select>
	<select id="isExist" resultType="cn.ssmc.entity.StudentChos">
		SELECT id FROM student_chos
		WHERE chos_id =#{ccID} AND
		student_id=#{stdID}
	</select>

	<select id="selectStudNum" resultType="java.lang.Integer">
		SELECT COUNT(sc.id) FROM
		student_chos sc LEFT JOIN t_chos c ON c.id =
		sc.chos_id LEFT JOIN
		t_terms t ON t.id=c.term_id WHERE student_id =#{id}
		AND t.flag=2
	</select>

	<select id="selectGetChooseByKey" parameterType="java.lang.Integer"
		resultType="cn.ssmc.entity.StudentChos">
		SELECT chos_id 'chooseCourse.id' FROM student_chos WHERE
		id=#{id}
	</select>
	<select id="selectByKeyScore" parameterType="java.lang.Integer"
		resultType="cn.ssmc.entity.StudentChos">
		SELECT id,score,chos_id 'chooseCourse.id' FROM student_chos
		WHERE
		id=#{id}
	</select>

	<select id="selectCname" resultType="cn.ssmc.entity.ChooseCourse">
		SELECT DISTINCT c.id id
		,c.course_id 'course.id'
		, c.course_name 'course.name' ,t.flag
		'terms.flag' FROM student_chos sc LEFT JOIN t_chos c ON
		sc.chos_id=c.id LEFT JOIN t_terms t ON t.id=c.term_id WHERE c.term_id
		= 3 AND c.teacher_id=#{teacherID}
	</select>

</mapper>